package com.clarityforandroid.controllers;

import com.clarityforandroid.R;
import com.clarityforandroid.helpers.ClarityDialogFactory;
import com.clarityforandroid.models.PatientModel;
import com.clarityforandroid.models.ProviderModel;
import com.clarityforandroid.views.CurrentUserView;

import android.app.Activity;
import android.app.ProgressDialog;
import android.content.Intent;
import android.graphics.Bitmap;
import android.hardware.Camera;
import android.os.Bundle;
import android.provider.MediaStore;
import android.view.View;
import android.view.Window;
import android.view.View.OnClickListener;

/**
 * The activity where you take a picture of the client.
 * 
 * @author Jonathan Ballands
 * @version 1.0
 */
public class CAPPictureActivity extends Activity {

	ProviderModel provider;
	PatientModel patient;

	CurrentUserView bar;
	
	Camera theCamera;

	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);

		// Get bundles
		provider = new ProviderModel();
		patient = new PatientModel();
		Intent incomingIntent = this.getIntent();
		if (incomingIntent != null) {
			patient = incomingIntent.getExtras().getParcelable("patient_model");
			provider = incomingIntent.getExtras().getParcelable("provider_model");
		}

		// Set up views
		this.requestWindowFeature(Window.FEATURE_NO_TITLE);
		this.setContentView(R.layout.activity_cap_camera);
		bar = (CurrentUserView)(findViewById(R.id.currentUserView));
		bar.initializeWithModel(provider);
		
		// Set listeners
		findViewById(R.id.start_camera_button).setOnClickListener(new CameraOnClickListener());
		findViewById(R.id.skip_camera_button).setOnClickListener(new SkipOnClickListener());
	}
	
	/**
	 * The listener that listens for the camera button.
	 * 
	 * @author Jonathan Ballands
	 * @version 1.0
	 */
	private class CameraOnClickListener implements OnClickListener {

		@Override
		public void onClick(View v) {
			Intent intent = new Intent(MediaStore.ACTION_IMAGE_CAPTURE);
			startActivityForResult(intent, -1);
		}
	}
	
	/**
	 * The listener that listens for the skip button.
	 * @author Jonathan Ballands
	 * @version 1.0
	 */
	private class SkipOnClickListener implements OnClickListener {

		@Override
		public void onClick(View v) {
			final ProgressDialog dialog = ClarityDialogFactory.displayNewChoiceDialog(CAPPictureActivity.this, "Skip This Step", 
					getString(R.string.skip_step_reassurance), "Yes", "No");
			dialog.findViewById(R.id.affirmative_button).setOnClickListener(new OnClickListener() {
				@Override
				public void onClick(View v) {
					dialog.dismiss();
				}
			});
			dialog.findViewById(R.id.negative_button).setOnClickListener(new OnClickListener() {
				@Override
				public void onClick(View v) {
					dialog.dismiss();
				}
			});
		}
	}
	
	/**
	 * 
	 */
	protected void onActivityResult(int requestCode, int resultCode,
            Intent data) {
        if (requestCode == PICK_CONTACT_REQUEST) {
            if (resultCode == RESULT_OK) {
                // A contact was picked.  Here we will just display it
                // to the user.
                startActivity(new Intent(Intent.ACTION_VIEW, data));
            }
        }
    }
}
